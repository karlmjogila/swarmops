suite: service tests
templates:
  - service.yaml
tests:
  - it: should render backend service when enabled
    set:
      backend.enabled: true
    documentIndex: 0
    asserts:
      - isKind:
          of: Service
      - equal:
          path: metadata.name
          value: RELEASE-NAME-hyperliquid-bot-backend

  - it: should render frontend service when enabled
    set:
      frontend.enabled: true
    documentIndex: 1
    asserts:
      - isKind:
          of: Service
      - equal:
          path: metadata.name
          value: RELEASE-NAME-hyperliquid-bot-frontend

  - it: should use ClusterIP type by default for backend
    set:
      backend.enabled: true
      backend.service.type: ClusterIP
    documentIndex: 0
    asserts:
      - equal:
          path: spec.type
          value: ClusterIP

  - it: should set correct backend port
    set:
      backend.enabled: true
      backend.service.port: 8000
      backend.service.targetPort: 8000
    documentIndex: 0
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 8000
      - equal:
          path: spec.ports[0].targetPort
          value: 8000

  - it: should set correct frontend port
    set:
      frontend.enabled: true
      frontend.service.port: 3000
      frontend.service.targetPort: 3000
    documentIndex: 1
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 3000
      - equal:
          path: spec.ports[0].targetPort
          value: 3000

  - it: should have correct selector labels for backend
    set:
      backend.enabled: true
    documentIndex: 0
    asserts:
      - isSubset:
          path: spec.selector
          content:
            app.kubernetes.io/name: hyperliquid-bot
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/component: backend

  - it: should have correct selector labels for frontend
    set:
      frontend.enabled: true
    documentIndex: 1
    asserts:
      - isSubset:
          path: spec.selector
          content:
            app.kubernetes.io/name: hyperliquid-bot
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/component: frontend

  - it: should apply service annotations
    set:
      backend.enabled: true
      backend.service.annotations:
        service.beta.kubernetes.io/aws-load-balancer-type: nlb
    documentIndex: 0
    asserts:
      - equal:
          path: metadata.annotations["service.beta.kubernetes.io/aws-load-balancer-type"]
          value: nlb

  - it: should name ports correctly
    set:
      backend.enabled: true
    documentIndex: 0
    asserts:
      - equal:
          path: spec.ports[0].name
          value: http
      - equal:
          path: spec.ports[0].protocol
          value: TCP
